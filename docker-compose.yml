
version: '3.8'

networks:
  relayer-demo:
    driver: bridge

services:
  relayer-database:
    build:
      context: database
      dockerfile: Dockerfile
    # image: postgres
    container_name: relayer-database
    # command: >
    #   /usr/config/entrypoint.sh
    environment:
      - POSTGRES_PASSWORD=mysecretpassword
      - POSTGRES_USER=postgres
    ports:
    - "5432:5432"
    expose: [5432]
    networks:
      - relayer-demo
  relayer-wss-1:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: relayer-wss-1
    # depends_on:
    #   - relayer-database
    environment:
      - WSS_NAME=wss-01
      - WSS_ADDRESS=http://relayer-wss-1:8000 # is internal to network
      - WSS_SOCKET_ADDRESS=ws://localhost:8002 # is external and accessible from host
      - DB_USER=postgres
      - DB_PWD=mysecretpassword
      - DB_HOST=relayer-database
      - DB_PORT=5432
    ports:
    - "8000:8000"
    - "8002:8002"
    networks:
      - relayer-demo
  relayer-wss-2:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: relayer-wss-2
    # depends_on:
    #   - relayer-database
    environment:
      - WSS_NAME=wss-02
      # TODO internal address and external address
      - WSS_ADDRESS=http://relayer-wss-2:8000 # is internal to network
      - WSS_SOCKET_ADDRESS=ws://localhost:8012 # is external and accessible from host
      - DB_USER=postgres
      - DB_PWD=mysecretpassword
      - DB_HOST=relayer-database
      - DB_PORT=5432
    ports:
    - "8010:8000"
    - "8012:8002"
    networks:
      - relayer-demo
